<!DOCTYPE html>
<html lang="pl">
<head>
    <meta charset="UTF-8">
    <title>Burger Bonanza</title>
    <style>
        * {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
            font-family: -apple-system, BlinkMacSystemFont, 'Segoe UI', sans-serif;
        }
        body {
            display: flex;
            flex-direction: column;
            align-items: center;
            min-height: 100vh;
            background: #ffffff;
            color: #1c2526;
            padding: 20px;
        }
        .game-container {
            width: 90%;
            max-width: 1200px;
            display: flex;
            gap: 16px;
            flex-wrap: wrap;
            justify-content: center;
        }
        .stats-container, .event-container, .quests-container, .minigame-container {
            background: #f2f2f7;
            border-radius: 18px;
            padding: 16px;
            width: 300px;
            text-align: center;
            box-shadow: 0 4px 12px rgba(0, 0, 0, 0.05);
        }
        .stats-container div, .event-container div, .quests-container div, .minigame-container div {
            font-size: 16px;
            font-weight: 500;
            color: #1c2526;
            margin: 8px 0;
        }
        #canvas-container {
            width: 400px;
            height: 400px;
            border-radius: 18px;
            overflow: hidden;
            box-shadow: 0 8px 24px rgba(0, 0, 0, 0.1);
            cursor: pointer;
            position: relative;
            background: #fff;
        }
        .shop-btn, .minigame-btn {
            padding: 12px 24px;
            font-size: 16px;
            font-weight: 600;
            background: #ff9500;
            color: #ffffff;
            border: none;
            border-radius: 12px;
            cursor: pointer;
            transition: background 0.3s ease, transform 0.2s ease;
        }
        .shop-btn:hover, .minigame-btn:hover {
            background: #e68a00;
            transform: translateY(-2px);
        }
        .popup {
            display: none;
            position: fixed;
            top: 50%;
            left: 50%;
            transform: translate(-50%, -50%);
            background: #ffffff;
            border-radius: 18px;
            padding: 20px;
            box-shadow: 0 10px 30px rgba(0, 0, 0, 0.2);
            z-index: 20;
            width: 90%;
            max-width: 500px;
            max-height: 80vh;
            overflow-y: auto;
            animation: popupIn 0.3s ease-out forwards;
        }
        .popup h2 {
            text-align: center;
            font-size: 20px;
            font-weight: 600;
            color: #1c2526;
            margin-bottom: 16px;
        }
        .tabs {
            display: flex;
            justify-content: center;
            gap: 8px;
            margin-bottom: 16px;
        }
        .tab-btn {
            padding: 8px 16px;
            background: #e5e5ea;
            border: none;
            border-radius: 10px;
            cursor: pointer;
            font-size: 14px;
            font-weight: 600;
            color: #1c2526;
            transition: background 0.3s ease, transform 0.2s ease;
        }
        .tab-btn.active {
            background: #ff9500;
            color: #ffffff;
            transform: scale(1.05);
        }
        .tab-content {
            display: none;
        }
        .tab-content.active {
            display: block;
        }
        .item {
            margin: 12px 0;
            padding: 12px;
            background: #f2f2f7;
            border-radius: 12px;
            display: flex;
            justify-content: space-between;
            align-items: center;
            transition: transform 0.2s ease;
        }
        .item:hover {
            transform: translateY(-2px);
        }
        .item p {
            font-size: 14px;
            font-weight: 500;
            color: #1c2526;
        }
        .item button {
            padding: 6px 12px;
            background: #ff9500;
            color: #ffffff;
            border: none;
            border-radius: 8px;
            cursor: pointer;
            font-size: 14px;
            font-weight: 600;
            transition: background 0.3s ease, transform 0.2s ease;
        }
        .item button:hover {
            background: #e68a00;
            transform: scale(1.05);
        }
        .item button:disabled {
            background: #c7c7cc;
            cursor: not-allowed;
        }
        #close-popup {
            display: block;
            margin: 16px auto 0;
            background: #ff3b30;
            padding: 12px 24px;
        }
        #close-popup:hover {
            background: #d32f2f;
            transform: translateY(-2px);
        }
        .notification {
            position: fixed;
            top: 20px;
            left: 50%;
            transform: translateX(-50%);
            background: #34c759;
            color: #ffffff;
            padding: 12px 24px;
            border-radius: 12px;
            box-shadow: 0 4px 12px rgba(0, 0, 0, 0.1);
            z-index: 30;
            font-size: 14px;
            font-weight: 600;
            animation: slideIn 0.5s ease forwards, slideOut 0.5s ease 3s forwards;
        }
        .click-particle {
            position: absolute;
            font-size: 18px;
            font-weight: 600;
            color: #ff3b30;
            pointer-events: none;
            animation: particleRise 1s ease-out forwards;
        }
        .progress-bar {
            width: 100%;
            background: #e5e5ea;
            border-radius: 8px;
            height: 10px;
            margin-top: 4px;
        }
        .progress {
            height: 100%;
            background: #34c759;
            border-radius: 8px;
            transition: width 0.3s ease;
        }
        @keyframes popupIn {
            0% { transform: translate(-50%, -60%); opacity: 0; }
            100% { transform: translate(-50%, -50%); opacity: 1; }
        }
        @keyframes slideIn {
            0% { top: -50px; opacity: 0; }
            100% { top: 20px; opacity: 1; }
        }
        @keyframes slideOut {
            0% { top: 20px; opacity: 1; }
            100% { top: -50px; opacity: 0; }
        }
        @keyframes particleRise {
            0% { opacity: 1; transform: translateY(0) scale(1); }
            100% { opacity: 0; transform: translateY(-50px) scale(1.5); }
        }
    </style>
</head>
<body>
    <div class="game-container">
        <div class="stats-container">
            <div id="burgers">Burgery: 0</div>
            <div id="spices">Przyprawy: 0</div>
            <div id="bps">BPS: 0</div>
        </div>
        <div id="canvas-container"></div>
        <div class="event-container">
            <div id="event-status">Brak aktywnego eventu</div>
        </div>
        <div class="quests-container">
            <div id="quests">Questy: 0/30</div>
            <button class="quests-btn">Sprawdź Questy</button>
        </div>
        <div class="minigame-container">
            <div id="minigame-status">Mini-gra: Burger Stack</div>
            <button class="minigame-btn">Zagraj</button>
        </div>
    </div>
    <button class="shop-btn">Sklep</button>
    <div id="shop-popup" class="popup">
        <h2>Sklep</h2>
        <div class="tabs">
            <button class="tab-btn active" data-tab="upgrades">Ulepszenia</button>
            <button class="tab-btn" data-tab="workers">Kucharze</button>
            <button class="tab-btn" data-tab="ingredients">Składniki</button>
        </div>
        <div id="upgrades-tab" class="tab-content active"></div>
        <div id="workers-tab" class="tab-content"></div>
        <div id="ingredients-tab" class="tab-content"></div>
        <button id="close-popup">Zamknij</button>
    </div>
    <div id="quests-popup" class="popup">
        <h2>Questy</h2>
        <div id="quests-list" style="max-height: 60vh; overflow-y: auto;"></div>
        <button id="close-quests">Zamknij</button>
    </div>
    <div id="minigame-popup" class="popup">
        <h2>Burger Stack</h2>
        <div id="minigame-canvas" style="width: 400px; height: 400px; background: #f0f0f0; border-radius: 12px;"></div>
        <div id="stack-score">Ułożone burgery: 0</div>
        <button id="close-minigame">Zamknij</button>
    </div>

    <script src="https://cdnjs.cloudflare.com/ajax/libs/three.js/r134/three.min.js"></script>
    <script>
        // Stan gry
        let burgers = 0;
        let spices = 0;
        let bps = 0;
        let eventActive = false;
        let burgerLayers = 1;
        let questsCompleted = 0;
        let activeEventColor = null;

        // Elementy DOM
        const burgersDisplay = document.getElementById('burgers');
        const spicesDisplay = document.getElementById('spices');
        const bpsDisplay = document.getElementById('bps');
        const eventStatus = document.getElementById('event-status');
        const canvasContainer = document.getElementById('canvas-container');
        const shopBtn = document.querySelector('.shop-btn');
        const shopPopup = document.getElementById('shop-popup');
        const closePopup = document.getElementById('close-popup');
        const questsBtn = document.querySelector('.quests-btn');
        const questsPopup = document.getElementById('quests-popup');
        const closeQuests = document.getElementById('close-quests');
        const minigameBtn = document.querySelector('.minigame-btn');
        const minigamePopup = document.getElementById('minigame-popup');
        const closeMinigame = document.getElementById('close-minigame');
        const stackScore = document.getElementById('stack-score');

        // Dane gry
        const upgrades = [
            { id: 'click-power', name: 'Moc Smażenia', cost: 50, level: 0, effect: 1 },
            { id: 'bps-boost', name: 'Boost BPS', cost: 100, level: 0, effect: 0.5 },
            { id: 'spice-chance', name: 'Szansa na Przyprawy', cost: 200, level: 0, effect: 0.005 }
        ];
        const workers = [
            { id: 'griller', name: 'Grillmaster', cost: 100, level: 0, bps: 1 },
            { id: 'chef', name: 'Szef Kuchni', cost: 500, level: 0, bps: 5 },
            { id: 'factory', name: 'Linia Produkcyjna', cost: 2000, level: 0, bps: 20 }
        ];
        const ingredients = [
            { id: 'cheese', name: 'Ser', cost: 10, spicesCost: 10, unlocked: false, layerHeight: 0.2, color: 0xffd700 },
            { id: 'lettuce', name: 'Sałata', cost: 50, spicesCost: 30, unlocked: false, layerHeight: 0.1, color: 0x00ff00 },
            { id: 'tomato', name: 'Pomidor', cost: 200, spicesCost: 70, unlocked: false, layerHeight: 0.15, color: 0xff0000 },
            { id: 'bacon', name: 'Bekon', cost: 500, spicesCost: 150, unlocked: false, layerHeight: 0.1, color: 0x8b4513 },
            { id: 'pickle', name: 'Ogórek', cost: 800, spicesCost: 200, unlocked: false, layerHeight: 0.1, color: 0x228b22 },
            { id: 'onion', name: 'Cebula', cost: 1200, spicesCost: 300, unlocked: false, layerHeight: 0.1, color: 0xffe4b5 },
            { id: 'bbq-sauce', name: 'Sos BBQ', cost: 2000, spicesCost: 500, unlocked: false, layerHeight: 0.05, color: 0x8a2be2 },
            { id: 'avocado', name: 'Awokado', cost: 3000, spicesCost: 800, unlocked: false, layerHeight: 0.15, color: 0x9acd32 },
            { id: 'mushrooms', name: 'Pieczarki', cost: 4500, spicesCost: 1200, unlocked: false, layerHeight: 0.1, color: 0xdeb887 },
            { id: 'jalapeno', name: 'Jalapeño', cost: 6000, spicesCost: 1800, unlocked: false, layerHeight: 0.1, color: 0xff4500 },
            { id: 'mayo', name: 'Majonez', cost: 8000, spicesCost: 2500, unlocked: false, layerHeight: 0.05, color: 0xfffafa },
            { id: 'blue-cheese', name: 'Ser Pleśniowy', cost: 10000, spicesCost: 3500, unlocked: false, layerHeight: 0.2, color: 0x4682b4 }
        ];
        const events = [
            { name: 'Burger Mania', effect: () => bps *= 2, duration: 30000, desc: 'Podwójne BPS przez 30 sekund!', color: 0xffd700, particleType: 'fire' },
            { name: 'Festiwal Smaku', effect: () => burgers += 10000, duration: 0, desc: '+10,000 burgerów!', color: 0x00ff00, particleType: 'stars' },
            { name: 'Szał Smażenia', effect: () => upgrades[0].effect *= 2, duration: 15000, desc: 'Podwójna moc smażenia!', color: 0xff4500, particleType: 'fire' },
            { name: 'Złota Przyprawa', effect: () => spices += 100, duration: 0, desc: '+100 przypraw!', color: 0xffff00, particleType: 'sparkles' },
            { name: 'Tajemniczy Sos', effect: () => upgrades[1].effect += 0.5, duration: 30000, desc: 'Zwiększony boost BPS!', color: 0x8a2be2, particleType: 'stars' },
            { name: 'Maraton Burgerów', effect: () => bps += 10, duration: 20000, desc: '+10 BPS przez 20 sekund!', color: 0x00b7eb, particleType: 'sparkles' },
            { name: 'Pikantny Burger', effect: () => spices += 50, duration: 0, desc: '+50 przypraw!', color: 0xff6347, particleType: 'fire' },
            { name: 'Podwójne Zamówienia', effect: () => workers.forEach(w => w.bps *= 2), duration: 15000, desc: 'Podwójna produkcja kucharzy!', color: 0x1e90ff, particleType: 'stars' },
            { name: 'Burgerowy Deszcz', effect: () => burgers += 20000, duration: 0, desc: '+20,000 burgerów!', color: 0x32cd32, particleType: 'sparkles' },
            { name: 'Turbo Smażenie', effect: () => bps *= 3, duration: 10000, desc: 'Potrójne BPS przez 10 sekund!', color: 0xff1493, particleType: 'fire' },
            { name: 'Szał Smaków', effect: () => upgrades[0].effect *= 1.5, duration: 20000, desc: '1.5x moc smażenia!', color: 0xff69b4, particleType: 'stars' },
            { name: 'Festiwal Burgerów', effect: () => workers.forEach(w => w.bps *= 1.5), duration: 20000, desc: '1.5x produkcja kucharzy!', color: 0x00ced1, particleType: 'sparkles' }
        ];
        const quests = [
            { id: 'burgers-500', name: 'Smaż 500 Burgerów', condition: () => burgers >= 500, progress: () => Math.min(burgers / 500, 1), reward: 50, completed: false },
            { id: 'bps-5', name: '5 BPS', condition: () => bps >= 5, progress: () => Math.min(bps / 5, 1), reward: 100, completed: false },
            { id: 'spices-50', name: '50 Przypraw', condition: () => spices >= 50, progress: () => Math.min(spices / 50, 1), reward: 150, completed: false },
            { id: 'layers-2', name: '2 Warstwy Burgera', condition: () => burgerLayers >= 2, progress: () => Math.min(burgerLayers / 2, 1), reward: 200, completed: false },
            { id: 'stack-1', name: 'Ułóż 1 Burgera', condition: () => stackBurgers >= 1, progress: () => Math.min(stackBurgers / 1, 1), reward: 250, completed: false },
            { id: 'burgers-1000', name: 'Smaż 1000 Burgerów', condition: () => burgers >= 1000, progress: () => Math.min(burgers / 1000, 1), reward: 300, completed: false },
            { id: 'bps-10', name: '10 BPS', condition: () => bps >= 10, progress: () => Math.min(bps / 10, 1), reward: 350, completed: false },
            { id: 'spices-100', name: '100 Przypraw', condition: () => spices >= 100, progress: () => Math.min(spices / 100, 1), reward: 400, completed: false },
            { id: 'layers-3', name: '3 Warstwy Burgera', condition: () => burgerLayers >= 3, progress: () => Math.min(burgerLayers / 3, 1), reward: 450, completed: false },
            { id: 'stack-3', name: 'Ułóż 3 Burgery', condition: () => stackBurgers >= 3, progress: () => Math.min(stackBurgers / 3, 1), reward: 500, completed: false },
            { id: 'burgers-5000', name: 'Smaż 5000 Burgerów', condition: () => burgers >= 5000, progress: () => Math.min(burgers / 5000, 1), reward: 550, completed: false },
            { id: 'bps-20', name: '20 BPS', condition: () => bps >= 20, progress: () => Math.min(bps / 20, 1), reward: 600, completed: false },
            { id: 'spices-200', name: '200 Przypraw', condition: () => spices >= 200, progress: () => Math.min(spices / 200, 1), reward: 650, completed: false },
            { id: 'layers-5', name: '5 Warstw Burgera', condition: () => burgerLayers >= 5, progress: () => Math.min(burgerLayers / 5, 1), reward: 700, completed: false },
            { id: 'stack-5', name: 'Ułóż 5 Burgerów', condition: () => stackBurgers >= 5, progress: () => Math.min(stackBurgers / 5, 1), reward: 750, completed: false },
            { id: 'burgers-10000', name: 'Smaż 10000 Burgerów', condition: () => burgers >= 10000, progress: () => Math.min(burgers / 10000, 1), reward: 800, completed: false },
            { id: 'bps-50', name: '50 BPS', condition: () => bps >= 50, progress: () => Math.min(bps / 50, 1), reward: 850, completed: false },
            { id: 'spices-500', name: '500 Przypraw', condition: () => spices >= 500, progress: () => Math.min(spices / 500, 1), reward: 900, completed: false },
            { id: 'layers-7', name: '7 Warstw Burgera', condition: () => burgerLayers >= 7, progress: () => Math.min(burgerLayers / 7, 1), reward: 950, completed: false },
            { id: 'stack-10', name: 'Ułóż 10 Burgerów', condition: () => stackBurgers >= 10, progress: () => Math.min(stackBurgers / 10, 1), reward: 1000, completed: false },
            { id: 'burgers-50000', name: 'Smaż 50000 Burgerów', condition: () => burgers >= 50000, progress: () => Math.min(burgers / 50000, 1), reward: 1050, completed: false },
            { id: 'bps-100', name: '100 BPS', condition: () => bps >= 100, progress: () => Math.min(bps / 100, 1), reward: 1100, completed: false },
            { id: 'spices-1000', name: '1000 Przypraw', condition: () => spices >= 1000, progress: () => Math.min(spices / 1000, 1), reward: 1150, completed: false },
            { id: 'layers-9', name: '9 Warstw Burgera', condition: () => burgerLayers >= 9, progress: () => Math.min(burgerLayers / 9, 1), reward: 1200, completed: false },
            { id: 'stack-15', name: 'Ułóż 15 Burgerów', condition: () => stackBurgers >= 15, progress: () => Math.min(stackBurgers / 15, 1), reward: 1250, completed: false },
            { id: 'burgers-100000', name: 'Smaż 100000 Burgerów', condition: () => burgers >= 100000, progress: () => Math.min(burgers / 100000, 1), reward: 1300, completed: false },
            { id: 'bps-200', name: '200 BPS', condition: () => bps >= 200, progress: () => Math.min(bps / 200, 1), reward: 1350, completed: false },
            { id: 'spices-2000', name: '2000 Przypraw', condition: () => spices >= 2000, progress: () => Math.min(spices / 2000, 1), reward: 1400, completed: false },
            { id: 'layers-11', name: '11 Warstw Burgera', condition: () => burgerLayers >= 11, progress: () => Math.min(burgerLayers / 11, 1), reward: 1450, completed: false },
            { id: 'stack-20', name: 'Ułóż 20 Burgerów', condition: () => stackBurgers >= 20, progress: () => Math.min(stackBurgers / 20, 1), reward: 1500, completed: false }
        ];

        // Three.js - Animacja 3D (główna gra)
        const scene = new THREE.Scene();
        const camera = new THREE.PerspectiveCamera(75, 400 / 400, 0.1, 1000);
        const renderer = new THREE.WebGLRenderer({ antialias: true });
        renderer.setSize(400, 400);
        renderer.setClearColor(0xffffff, 1);
        canvasContainer.appendChild(renderer.domElement);

        const burgerGroup = new THREE.Group();
        scene.add(burgerGroup);

        const bunMaterial = new THREE.MeshStandardMaterial({ color: 0xf5c77e });
        const pattyMaterial = new THREE.MeshStandardMaterial({ color: 0x8b4513 });

        const bunBottom = new THREE.Mesh(new THREE.CylinderGeometry(1.5, 1.5, 0.5, 32), bunMaterial);
        bunBottom.position.y = -0.25;
        burgerGroup.add(bunBottom);

        const patty = new THREE.Mesh(new THREE.CylinderGeometry(1.3, 1.3, 0.3, 32), pattyMaterial);
        patty.position.y = 0.1;
        burgerGroup.add(patty);

        const bunTop = new THREE.Mesh(new THREE.CylinderGeometry(1.5, 1.5, 0.5, 32), bunMaterial);
        bunTop.position.y = 0.55;
        burgerGroup.add(bunTop);

        const ambientLight = new THREE.AmbientLight(0xffffff, 0.6);
        scene.add(ambientLight);
        const pointLight = new THREE.PointLight(0xffffff, 1);
        pointLight.position.set(5, 5, 5);
        scene.add(pointLight);

        camera.position.z = 5;

        let rotationSpeed = 0.01;
        let bounce = 0;
        let targetScale = 1;
        let currentScale = 1;
        let scaleVelocity = 0;
        let backgroundHue = 0;

        // Cząsteczki 3D dla kliknięć
        const clickParticleGroup = new THREE.Group();
        scene.add(clickParticleGroup);

        function createClickParticle() {
            const particleGeometry = new THREE.SphereGeometry(0.1, 16, 16);
            const particleMaterial = new THREE.MeshBasicMaterial({ color: 0xff3b30 });
            const particle = new THREE.Mesh(particleGeometry, particleMaterial);
            particle.position.set((Math.random() - 0.5) * 2, 0, (Math.random() - 0.5) * 2);
            clickParticleGroup.add(particle);
            const startTime = Date.now();
            const animateParticle = () => {
                const elapsed = (Date.now() - startTime) / 1000;
                particle.position.y += 0.05;
                particle.scale.setScalar(1 + elapsed);
                particle.material.opacity = 1 - elapsed;
                if (elapsed > 1) {
                    clickParticleGroup.remove(particle);
                } else {
                    requestAnimationFrame(animateParticle);
                }
            };
            animateParticle();
        }

        // Cząsteczki 3D dla eventów
        const eventParticleGroup = new THREE.Group();
        scene.add(eventParticleGroup);

        function createEventParticle(type) {
            if (type === 'fire') {
                const particleGeometry = new THREE.SphereGeometry(0.05, 8, 8);
                const particleMaterial = new THREE.MeshBasicMaterial({ color: 0xff4500 });
                const particle = new THREE.Mesh(particleGeometry, particleMaterial);
                particle.position.set((Math.random() - 0.5) * 5, (Math.random() - 0.5) * 5, (Math.random() - 0.5) * 5);
                eventParticleGroup.add(particle);
                const startTime = Date.now();
                const animateParticle = () => {
                    const elapsed = (Date.now() - startTime) / 1000;
                    particle.position.y += 0.1;
                    particle.material.color.setHSL(0.05 + elapsed * 0.1, 1, 0.5);
                    particle.material.opacity = 1 - elapsed;
                    if (elapsed > 1) {
                        eventParticleGroup.remove(particle);
                    } else {
                        requestAnimationFrame(animateParticle);
                    }
                };
                animateParticle();
            } else if (type === 'sparkles') {
                const particleGeometry = new THREE.TetrahedronGeometry(0.1);
                const particleMaterial = new THREE.MeshBasicMaterial({ color: 0xffff00 });
                const particle = new THREE.Mesh(particleGeometry, particleMaterial);
                particle.position.set((Math.random() - 0.5) * 5, (Math.random() - 0.5) * 5, (Math.random() - 0.5) * 5);
                eventParticleGroup.add(particle);
                const startTime = Date.now();
                const animateParticle = () => {
                    const elapsed = (Date.now() - startTime) / 1000;
                    particle.rotation.x += 0.1;
                    particle.rotation.y += 0.1;
                    particle.position.y += 0.05;
                    particle.material.opacity = 1 - elapsed;
                    if (elapsed > 1) {
                        eventParticleGroup.remove(particle);
                    } else {
                        requestAnimationFrame(animateParticle);
                    }
                };
                animateParticle();
            } else if (type === 'stars') {
                const particleGeometry = new THREE.BoxGeometry(0.1, 0.1, 0.1);
                const particleMaterial = new THREE.MeshBasicMaterial({ color: 0x00ff00 });
                const particle = new THREE.Mesh(particleGeometry, particleMaterial);
                particle.position.set((Math.random() - 0.5) * 5, (Math.random() - 0.5) * 5, (Math.random() - 0.5) * 5);
                eventParticleGroup.add(particle);
                const startTime = Date.now();
                const animateParticle = () => {
                    const elapsed = (Date.now() - startTime) / 1000;
                    particle.rotation.x += 0.2;
                    particle.rotation.y += 0.2;
                    particle.position.x += Math.sin(elapsed * 2) * 0.05;
                    particle.position.z += Math.cos(elapsed * 2) * 0.05;
                    particle.material.opacity = 1 - elapsed;
                    if (elapsed > 1) {
                        eventParticleGroup.remove(particle);
                    } else {
                        requestAnimationFrame(animateParticle);
                    }
                };
                animateParticle();
            }
        }

        function animate() {
            requestAnimationFrame(animate);
            burgerGroup.rotation.y += rotationSpeed;
            bounce += 0.05;
            burgerGroup.position.y = Math.sin(bounce) * 0.2;

            const scaleDiff = targetScale - currentScale;
            scaleVelocity += scaleDiff * 0.1;
            scaleVelocity *= 0.9;
            currentScale += scaleVelocity;
            burgerGroup.scale.set(currentScale, currentScale, currentScale);

            // Dynamiczne tło podczas eventu (tęczowe kolory)
            if (eventActive) {
                backgroundHue += 0.01;
                const color = new THREE.Color();
                color.setHSL(backgroundHue % 1, 0.8, 0.6);
                renderer.setClearColor(color, 1);
            } else {
                renderer.setClearColor(0xffffff, 1);
            }

            renderer.render(scene, camera);
        }
        animate();

        // Płynne liczniki
        let displayedBurgers = 0;
        let displayedSpices = 0;
        let displayedBps = 0;
        function updateDisplay() {
            const animateCounter = (start, end, element, prefix) => {
                const duration = 500;
                const startTime = Date.now();
                const step = () => {
                    const elapsed = (Date.now() - startTime) / duration;
                    const value = Math.round(start + (end - start) * Math.min(elapsed, 1));
                    element.textContent = `${prefix}: ${value}`;
                    if (elapsed < 1) requestAnimationFrame(step);
                };
                step();
            };
            animateCounter(displayedBurgers, burgers, burgersDisplay, 'Burgery');
            animateCounter(displayedSpices, spices, spicesDisplay, 'Przyprawy');
            animateCounter(displayedBps, bps, bpsDisplay, 'BPS');
            displayedBurgers = burgers;
            displayedSpices = spices;
            displayedBps = bps;
        }

        // Funkcje gry
        function saveGame() {
            const state = { burgers, spices, bps, upgrades, workers, ingredients, burgerLayers, quests, stackBurgers, questsCompleted };
            localStorage.setItem('burgerBonanza', JSON.stringify(state));
        }

        function loadGame() {
            const state = JSON.parse(localStorage.getItem('burgerBonanza'));
            if (state) {
                burgers = state.burgers || 0;
                spices = state.spices || 0;
                bps = state.bps || 0;
                burgerLayers = state.burgerLayers || 1;
                stackBurgers = state.stackBurgers || 0;
                questsCompleted = state.questsCompleted || 0;
                upgrades.forEach((u, i) => Object.assign(u, state.upgrades[i]));
                workers.forEach((w, i) => Object.assign(w, state.workers[i]));
                ingredients.forEach((ing, i) => Object.assign(ing, state.ingredients[i]));
                quests.forEach((q, i) => Object.assign(q, state.quests[i]));
            }
            updateBurger();
            updateDisplay();
            updateQuests();
        }

        function createParticle(x, y, text) {
            const particle = document.createElement('div');
            particle.className = 'click-particle';
            particle.textContent = text;
            particle.style.left = `${x}px`;
            particle.style.top = `${y}px`;
            canvasContainer.appendChild(particle);
            setTimeout(() => particle.remove(), 1000);
        }

        function notify(message) {
            const notif = document.createElement('div');
            notif.className = 'notification';
            notif.textContent = message;
            document.body.appendChild(notif);
            setTimeout(() => notif.remove(), 3500);
        }

        function updateBurger() {
            while (burgerGroup.children.length > 3) {
                burgerGroup.remove(burgerGroup.children[3]);
            }

            let currentHeight = 0.55;
            ingredients.forEach(ing => {
                if (ing.unlocked) {
                    const layer = new THREE.Mesh(
                        new THREE.CylinderGeometry(1.3, 1.3, ing.layerHeight, 32),
                        new THREE.MeshStandardMaterial({ color: activeEventColor || ing.color })
                    );
                    currentHeight += ing.layerHeight;
                    layer.position.y = currentHeight - ing.layerHeight / 2;
                    burgerGroup.add(layer);
                }
            });
            bunTop.position.y = currentHeight + 0.25;

            if (activeEventColor) {
                bunMaterial.color.setHex(activeEventColor);
                pattyMaterial.color.setHex(activeEventColor);
            } else {
                bunMaterial.color.setHex(0xf5c77e);
                pattyMaterial.color.setHex(0x8b4513);
            }
        }

        // Mechanika klikania
        canvasContainer.addEventListener('click', (e) => {
            const clickPower = upgrades[0].effect * (1 + upgrades[0].level);
            burgers += clickPower;
            if (Math.random() < upgrades[2].effect) spices += 1;
            const rect = canvasContainer.getBoundingClientRect();
            createParticle(e.clientX - rect.left, e.clientY - rect.top, `+${Math.round(clickPower)}`);
            createClickParticle();

            targetScale = 1.2;
            rotationSpeed = 0.1;
            setTimeout(() => {
                targetScale = 1;
                rotationSpeed = 0.01;
            }, 200);

            updateDisplay();
            checkQuests();
            saveGame();
        });

        // Sklep
        function updateShop() {
            const upgradesTab = document.getElementById('upgrades-tab');
            upgradesTab.innerHTML = upgrades.map(u => `
                <div class="item">
                    <p>${u.name} (Lv. ${u.level})</p>
                    <button data-type="upgrade" data-id="${u.id}" ${burgers < u.cost ? 'disabled' : ''}>Kup (${u.cost})</button>
                </div>
            `).join('');

            const workersTab = document.getElementById('workers-tab');
            workersTab.innerHTML = workers.map(w => `
                <div class="item">
                    <p>${w.name} (Lv. ${w.level}) - ${w.bps} BPS</p>
                    <button data-type="worker" data-id="${w.id}" ${burgers < w.cost ? 'disabled' : ''}>Kup (${w.cost})</button>
                </div>
            `).join('');

            const ingredientsTab = document.getElementById('ingredients-tab');
            ingredientsTab.innerHTML = ingredients.map(ing => `
                <div class="item">
                    <p>${ing.name} ${ing.unlocked ? '(Odblokowane)' : ''}</p>
                    <button data-type="ingredient" data-id="${ing.id}" ${ing.unlocked || (burgers < ing.cost || spices < ing.spicesCost) ? 'disabled' : ''}>Odblokuj (${ing.cost} burgerów, ${ing.spicesCost} przypraw)</button>
                </div>
            `).join('');
        }

        shopBtn.addEventListener('click', () => {
            shopPopup.style.display = 'block';
            updateShop();
        });

        closePopup.addEventListener('click', () => {
            shopPopup.style.display = 'none';
        });

        document.querySelectorAll('.tab-btn').forEach(btn => {
            btn.addEventListener('click', () => {
                document.querySelectorAll('.tab-btn').forEach(b => b.classList.remove('active'));
                document.querySelectorAll('.tab-content').forEach(c => c.classList.remove('active'));
                btn.classList.add('active');
                document.getElementById(`${btn.dataset.tab}-tab`).classList.add('active');
            });
        });

        shopPopup.addEventListener('click', (e) => {
            if (e.target.tagName === 'BUTTON' && e.target.dataset.type) {
                const type = e.target.dataset.type;
                const id = e.target.dataset.id;
                if (type === 'upgrade') {
                    const u = upgrades.find(u => u.id === id);
                    if (burgers >= u.cost) {
                        burgers -= u.cost;
                        u.level++;
                        u.cost = Math.round(u.cost * 1.5);
                        notify(`✅ Kupiono: ${u.name} (Lv. ${u.level})`);
                    }
                } else if (type === 'worker') {
                    const w = workers.find(w => w.id === id);
                    if (burgers >= w.cost) {
                        burgers -= w.cost;
                        w.level++;
                        bps += w.bps;
                        w.cost = Math.round(w.cost * 1.5);
                        notify(`✅ Zatrudniono: ${w.name} (Lv. ${w.level})`);
                    }
                } else if (type === 'ingredient') {
                    const ing = ingredients.find(ing => ing.id === id);
                    if (!ing.unlocked && burgers >= ing.cost && spices >= ing.spicesCost) {
                        burgers -= ing.cost;
                        spices -= ing.spicesCost;
                        ing.unlocked = true;
                        burgerLayers++;
                        updateBurger();
                        notify(`✅ Odblokowano: ${ing.name}!`);
                    }
                }
                updateDisplay();
                updateShop();
                checkQuests();
                saveGame();
            }
        });

        // Eventy (automatyczne)
        let currentParticleType = null;
        function triggerEvent() {
            if (!eventActive && Math.random() < 0.15) {
                const event = events[Math.floor(Math.random() * events.length)];
                eventActive = true;
                eventStatus.textContent = event.name;
                activeEventColor = event.color;
                currentParticleType = event.particleType;
                updateBurger();
                event.effect();
                notify(`🎉 ${event.desc}`);
                updateDisplay();
                if (event.duration > 0) {
                    setTimeout(() => {
                        eventActive = false;
                        eventStatus.textContent = 'Brak aktywnego eventu';
                        activeEventColor = null;
                        currentParticleType = null;
                        while (eventParticleGroup.children.length > 0) {
                            eventParticleGroup.remove(eventParticleGroup.children[0]);
                        }
                        updateBurger();
                        if (event.name === 'Burger Mania') bps /= 2;
                        else if (event.name === 'Szał Smażenia') upgrades[0].effect /= 2;
                        else if (event.name === 'Podwójne Zamówienia') workers.forEach(w => w.bps /= 2);
                        else if (event.name === 'Turbo Smażenie') bps /= 3;
                        else if (event.name === 'Szał Smaków') upgrades[0].effect /= 1.5;
                        else if (event.name === 'Festiwal Burgerów') workers.forEach(w => w.bps /= 1.5);
                        updateDisplay();
                    }, event.duration);
                } else {
                    eventActive = false;
                    eventStatus.textContent = 'Brak aktywnego eventu';
                    activeEventColor = null;
                    currentParticleType = null;
                    while (eventParticleGroup.children.length > 0) {
                        eventParticleGroup.remove(eventParticleGroup.children[0]);
                    }
                    updateBurger();
                }
            }

            // Generowanie cząsteczek podczas eventu
            if (eventActive && currentParticleType) {
                for (let i = 0; i < 3; i++) {
                    createEventParticle(currentParticleType);
                }
            }
        }

        // Questy
        function updateQuests() {
            const questsList = document.getElementById('quests-list');
            questsList.innerHTML = quests.map(q => `
                <div class="item">
                    <p>${q.name} ${q.completed ? '✅' : ''}</p>
                    <div class="progress-bar">
                        <div class="progress" style="width: ${q.progress() * 100}%"></div>
                    </div>
                </div>
            `).join('');
            document.getElementById('quests').textContent = `Questy: ${questsCompleted}/${quests.length}`;
        }

        function checkQuests() {
            let newCompletions = 0;
            quests.forEach(q => {
                if (!q.completed && q.condition()) {
                    q.completed = true;
                    spices += q.reward;
                    newCompletions++;
                    notify(`✅ Quest: ${q.name}! +${q.reward} przypraw`);
                }
            });
            questsCompleted += newCompletions;
            updateQuests();
            updateDisplay();
        }

        questsBtn.addEventListener('click', () => {
            questsPopup.style.display = 'block';
            updateQuests();
        });

        closeQuests.addEventListener('click', () => {
            questsPopup.style.display = 'none';
        });

        // Mini-gra Burger Stack
        let stackBurgers = 0;
        const minigameScene = new THREE.Scene();
        const minigameCamera = new THREE.PerspectiveCamera(75, 400 / 400, 0.1, 1000);
        const minigameRenderer = new THREE.WebGLRenderer({ antialias: true });
        minigameRenderer.setSize(400, 400);
        document.getElementById('minigame-canvas').appendChild(minigameRenderer.domElement);

        const platform = new THREE.Mesh(
            new THREE.BoxGeometry(2, 0.2, 1),
            new THREE.MeshBasicMaterial({ color: 0x808080 })
        );
        platform.position.set(0, -3, 0);
        minigameScene.add(platform);

        const stackIngredients = [];
        const correctOrder = ['bunBottom', 'patty', 'cheese', 'bunTop'];
        let currentIngredientIndex = 0;
        let fallingIngredient = null;
        let hasMissed = false; // Flaga do kontrolowania powiadomienia o niepowodzeniu
        let timeInRange = 0; // Licznik czasu, przez który składnik był w zasięgu platformy
        let isMinigamePaused = false; // Flaga do wstrzymania mini-gry

        function spawnIngredient() {
            if (!fallingIngredient && !isMinigamePaused) {
                const type = correctOrder[currentIngredientIndex];
                const geometry = type === 'bunBottom' || type === 'bunTop' ? new THREE.CylinderGeometry(0.5, 0.5, 0.2, 32) : new THREE.CylinderGeometry(0.4, 0.4, 0.1, 32);
                const material = new THREE.MeshBasicMaterial({ 
                    color: type === 'bunBottom' || type === 'bunTop' ? 0xf5c77e : type === 'patty' ? 0x8b4513 : 0xffd700 
                });
                fallingIngredient = new THREE.Mesh(geometry, material);
                fallingIngredient.position.set((Math.random() - 0.5) * 4, 5, 0);
                minigameScene.add(fallingIngredient);
                hasMissed = false; // Reset flagi przy nowym składniku
                timeInRange = 0; // Reset licznika czasu w zasięgu
            }
        }

        let platformVelocity = 0;
        document.addEventListener('keydown', (e) => {
            if (minigamePopup.style.display === 'block') {
                if (e.key === 'ArrowLeft') platformVelocity = -0.2;
                if (e.key === 'ArrowRight') platformVelocity = 0.2;
            }
        });
        document.addEventListener('keyup', (e) => {
            if (e.key === 'ArrowLeft' || e.key === 'ArrowRight') platformVelocity = 0;
        });

        function animateMinigame() {
            if (isMinigamePaused) return; // Wstrzymaj animację, jeśli zakładka jest nieaktywna

            requestAnimationFrame(animateMinigame);

            platform.position.x += platformVelocity;
            platform.position.x = Math.max(-3, Math.min(3, platform.position.x));

            if (fallingIngredient) {
                fallingIngredient.position.y -= 0.1;

                // Sprawdzenie, czy składnik jest w zasięgu platformy
                const isInRange = fallingIngredient.position.x >= platform.position.x - 1 && 
                                  fallingIngredient.position.x <= platform.position.x + 1;
                if (isInRange && fallingIngredient.position.y <= 0) {
                    timeInRange += 1; // Zwiększ licznik czasu w zasięgu (każda klatka to ~16ms)
                }

                if (fallingIngredient.position.y <= -2.8 && isInRange) {
                    stackIngredients.push(fallingIngredient);
                    fallingIngredient.position.y = -2.8 + stackIngredients.length * 0.2;
                    fallingIngredient.position.x = platform.position.x;
                    minigameScene.remove(fallingIngredient);
                    minigameScene.add(fallingIngredient);
                    fallingIngredient = null;
                    currentIngredientIndex++;
                    if (currentIngredientIndex === correctOrder.length) {
                        stackBurgers++;
                        spices += 10;
                        stackScore.textContent = `Ułożone burgery: ${stackBurgers}`;
                        notify(`✅ Ułożono burgera! +10 przypraw`);
                        currentIngredientIndex = 0;
                        stackIngredients.forEach(ing => minigameScene.remove(ing));
                        stackIngredients.length = 0;
                        checkQuests();
                    }
                } else if (fallingIngredient.position.y < -5) {
                    // Powiadomienie tylko jeśli składnik był w zasięgu przez wystarczająco długo
                    if (timeInRange > 30 && !hasMissed) { // 30 klatek to ~0.5 sekundy
                        notify(`❌ Nie udało się ułożyć burgera!`);
                        hasMissed = true;
                    }
                    minigameScene.remove(fallingIngredient);
                    fallingIngredient = null;
                    currentIngredientIndex = 0;
                    stackIngredients.forEach(ing => minigameScene.remove(ing));
                    stackIngredients.length = 0;
                }
            }

            spawnIngredient();
            minigameRenderer.render(minigameScene, minigameCamera);
        }
        animateMinigame();

        minigameCamera.position.set(0, 0, 5);
        minigameCamera.lookAt(0, 0, 0);

        minigameBtn.addEventListener('click', () => {
            minigamePopup.style.display = 'block';
            stackScore.textContent = `Ułożone burgery: ${stackBurgers}`;
            isMinigamePaused = false; // Wznów mini-grę przy otwarciu
        });

        closeMinigame.addEventListener('click', () => {
            minigamePopup.style.display = 'none';
            currentIngredientIndex = 0;
            stackIngredients.forEach(ing => minigameScene.remove(ing));
            stackIngredients.length = 0;
            if (fallingIngredient) {
                minigameScene.remove(fallingIngredient);
                fallingIngredient = null;
            }
            isMinigamePaused = true; // Wstrzymaj mini-grę przy zamknięciu
        });

        // Wstrzymywanie mini-gry, gdy zakładka jest nieaktywna
        document.addEventListener('visibilitychange', () => {
            if (document.visibilityState === 'hidden') {
                isMinigamePaused = true;
            } else if (document.visibilityState === 'visible' && minigamePopup.style.display === 'block') {
                isMinigamePaused = false;
                animateMinigame(); // Wznów animację
            }
        });

        // Automatyczne BPS i eventy
        setInterval(() => {
            burgers += bps;
            updateDisplay();
            triggerEvent();
            checkQuests();
            saveGame();
        }, 1000);

        // Inicjalizacja
        loadGame();
        updateShop();
    </script>
</body>
</html>
<html lang="pl">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Twoja Strona</title>
    <!-- Dodaj styl popupu -->
    <style>
        body {
            margin: 0;
            padding: 0;
        }
        .dock-popup {
            position: fixed;
            bottom: 20px;
            left: 50%;
            transform: translateX(-50%);
            background-color: rgba(255, 255, 255, 0.9);
            backdrop-filter: blur(10px);
            border-radius: 20px;
            padding: 10px;
            box-shadow: 0 4px 15px rgba(0, 0, 0, 0.2);
            z-index: 1000;
        }
        .dock-menu {
            display: flex;
            justify-content: center;
            align-items: center;
            gap: 20px;
            margin: 0;
            padding: 0;
        }
        .dock-menu a {
            color: #333;
            text-decoration: none;
            font-family: "SF Pro Text", "Helvetica Neue", Arial, sans-serif;
            font-size: 14px;
            padding: 8px 15px;
            background-color: rgba(240, 240, 240, 0.8);
            border-radius: 15px;
            transition: transform 0.2s ease, background-color 0.2s ease;
        }
        .dock-menu a:hover {
            transform: scale(1.1);
            background-color: rgba(200, 200, 200, 0.9);
        }
        @media (max-width: 768px) {
            .dock-menu {
                gap: 10px;
                padding: 5px;
            }
            .dock-menu a {
                font-size: 12px;
                padding: 6px 12px;
            }
        }
    </style>
</head>
<body>
    <!-- Twoja treść -->
    <div style="text-align: center;">
       
    </div>

    <!-- Dodaj popup -->
    <div class="dock-popup">
        <div class="dock-menu">
            <a href="index.html">CLICKER</a>
            <a href="kotletclicker2.html">BETA</a>
            <a href="discord.html">DISCORD</a>
            <a href="leaderboard.html">TOPKA</a>
            <a href="zasady.html">ZASADY</a>
        </div>
    </div>
</body>
</html>
