<!DOCTYPE html>
<html lang="pl">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no">
    <title>Kotlet: Ostatni Bastion</title>
    <style>
        /* Styl pozostaje bez zmian */
        body {
            margin: 0;
            padding: 0;
            background: #0a0a0a;
            font-family: 'Arial', sans-serif;
            overflow: hidden;
            height: 100vh;
            display: flex;
            justify-content: center;
            align-items: center;
        }

        #gameContainer {
            width: 100vw;
            height: 100vh;
            max-width: 600px;
            max-height: 800px;
            position: relative;
            background: linear-gradient(180deg, #1c2526, #0a0a0a);
            border-radius: 0;
            box-shadow: none;
            overflow: hidden;
        }

        #canvas {
            width: 100%;
            height: 100%;
            position: absolute;
            display: none;
            touch-action: none;
        }

        #menu, #gameOverScreen {
            position: absolute;
            top: 0;
            left: 0;
            width: 100%;
            height: 100%;
            display: flex;
            flex-direction: column;
            justify-content: center;
            align-items: center;
            background: rgba(0, 0, 0, 0.9);
            color: #fff;
            z-index: 20;
            padding: 20px;
            box-sizing: border-box;
        }

        #gameOverScreen {
            display: none;
        }

        .menu-button, .difficulty-button, .retry-button {
            padding: 12px 24px;
            margin: 8px;
            background: linear-gradient(45deg, #ff3b30, #ff9500);
            color: #fff;
            border: none;
            border-radius: 8px;
            font-size: 16px;
            transition: all 0.3s ease;
            width: 80%;
            max-width: 300px;
            text-align: center;
            touch-action: manipulation;
        }

        .menu-button:active, .difficulty-button:active, .retry-button:active {
            transform: scale(0.95);
            box-shadow: 0 0 15px rgba(255, 147, 0, 0.5);
        }

        #ui {
            position: absolute;
            top: 5px;
            left: 5px;
            color: #fff;
            font-size: 14px;
            padding: 5px 10px;
            background: rgba(255, 255, 255, 0.1);
            border-radius: 5px;
            display: none;
        }

        #shop {
            position: absolute;
            bottom: 5px;
            left: 50%;
            transform: translateX(-50%);
            display: flex;
            flex-wrap: wrap;
            justify-content: center;
            gap: цију

            /* Pozostała część stylów bez zmian */
        </style>
    </head>
    <body>
        <div id="gameContainer">
            <canvas id="canvas"></canvas>
            <div id="redLine"></div>
            <div id="ui">Punkty: <span id="score">0</span> | Tarcza: <span id="shield">0</span></div>
            <div id="waveDisplay">Fala: <span id="wave">1</span></div>
            <div id="shop">
                <button class="shop-button" onclick="upgradePower()">Moc +1 (50)</button>
                <button class="shop-button" onclick="upgradeSpeed()">Szybkość +1 (75)</button>
                <button class="shop-button" onclick="upgradeShield()">Tarcza +1 (100)</button>
                <button class="shop-button" onclick="upgradeLasers()">Lasery +1 (150)</button>
            </div>
            <div id="notification"></div>
            <div id="menu">
                <h1 style="font-size: 24px;">Kotlet: Ostatni Bastion</h1>
                <p style="font-size: 16px;">Rekord: <span id="highScore">0</span></p>
                <button class="difficulty-button" id="easyButton">Łatwy</button>
                <button class="difficulty-button" id="mediumButton">Średni</button>
                <button class="difficulty-button" id="hardButton">Trudny</button>
            </div>
            <div id="gameOverScreen">
                <h1 style="font-size: 24px;">Koniec Gry!</h1>
                <p style="font-size: 16px;">Punkty: <span id="finalScore">0</span></p>
                <p style="font-size: 16px;">Fala: <span id="finalWave">1</span></p>
                <button class="retry-button" onclick="resetGame()">Spróbuj Ponownie</button>
            </div>
        </div>

        <script>
            const canvas = document.getElementById('canvas');
            const ctx = canvas.getContext('2d');
            const notification = document.getElementById('notification');
            const scoreDisplay = document.getElementById('score');
            const shieldDisplay = document.getElementById('shield');
            const waveDisplay = document.getElementById('wave');
            const menu = document.getElementById('menu');
           Pillars = document.getElementById('gameOverScreen');
            const finalScore = document.getElementById('finalScore');
            const finalWave = document.getElementById('finalWave');
            const ui = document.getElementById('ui');
            const shop = document.getElementById('shop');
            const redLine = document.getElementById('redLine');
            const highScoreDisplay = document.getElementById('highScore');

            function resizeCanvas() {
                const container = document.getElementById('gameContainer');
                canvas.width = container.clientWidth;
                canvas.height = container.clientHeight;
                kotlet.y = canvas.height - 50;
            }
            window.addEventListener('resize', resizeCanvas);
            resizeCanvas();

            let score = 0;
            let highScore = localStorage.getItem('highScore') ? parseInt(localStorage.getItem('highScore')) : 0;
            highScoreDisplay.textContent = highScore;
            let kotlet = {
                x: canvas.width / 2,
                y: canvas.height - 50,
                speed: 5,
                laserPower: 1,
                shield: 0,
                extraLasers: 0
            };
            let chickens = [];
            let lasers = [];
            let particles = [];
            let achievements = new Set();
            let gameOver = true;
            let difficulty = 0.015;
            let difficultyMultiplier = 1;
            let wave = 1;
            let enemiesToSpawn = 5;
            let enemiesSpawned = 0;
            let animationFrameId = null;
            let bossSpawnTimer = 0;

            // [Pozostałe stałe jak BOSSES, ACHIEVEMENTS i audio bez zmian]

            function startGame(diff, diffMultiplier) {
                console.log('Starting game with difficulty:', diff, 'multiplier:', diffMultiplier); // Debug
                if (!gameOver) return;
                difficulty = diff;
                difficultyMultiplier = diffMultiplier;
                menu.style.display = 'none';
                canvas.style.display = 'block';
                ui.style.display = 'block';
                shop.style.display = 'flex';
                redLine.style.display = 'block';
                waveDisplay.parentElement.style.display = 'block';
                gameOver = false;
                score = 0;
                wave = 1;
                enemiesToSpawn = 5;
                enemiesSpawned = 0;
                kotlet = { x: canvas.width / 2, y: canvas.height - 50, speed: 5, laserPower: 1, shield: 0, extraLasers: 0 };
                chickens = [];
                lasers = [];
                particles = [];
                achievements.clear();
                scoreDisplay.textContent = score;
                shieldDisplay.textContent = kotlet.shield;
                waveDisplay.textContent = wave;
                bossSpawnTimer = 0;
                if (animationFrameId) cancelAnimationFrame(animationFrameId);
                backgroundMusic.play();
                update();
            }

            // [Pozostała część funkcji jak resetGame, spawnChicken itp. bez zmian]

            // Dodanie obsługi zdarzeń dotykowych dla przycisków menu
            document.getElementById('easyButton').addEventListener('touchend', () => {
                console.log('Easy mode selected'); // Debug
                startGame(0.01, 1);
            });
            document.getElementById('mediumButton').addEventListener('touchend', () => {
                console.log('Medium mode selected'); // Debug
                startGame(0.015, 1.5);
            });
            document.getElementById('hardButton').addEventListener('touchend', () => {
                console.log('Hard mode selected'); // Debug
                startGame(0.02, 2);
            });

            // [Pozostała część kodu JavaScript bez zmian]

            // Upewnienie się, że canvas jest gotowy
            window.addEventListener('load', () => {
                resizeCanvas();
                console.log('Canvas initialized'); // Debug
            });
        </script>
    </body>
</html>
